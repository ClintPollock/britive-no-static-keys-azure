name: Britive-GitHub Federated Access for Azure via OpenID Connect

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  federated-azure-access:
    runs-on: ubuntu-latest

    env:
      BRITIVE_TENANT: demo
      BRITIVE_PROFILE_NAME: Britive Azure Tenant/Britive Azure Tenant/Directory Reader
      FED_PROVIDER: github-britive

    steps:
      - name: Install pybritive
        run: |
          pip install pybritive --quiet

      - name: Checkout access from Britive and login to Azure
        run: |
          # Use pybritive to output a ready-to-use az login command
          LOGIN_CMD=$(pybritive checkout -t demo.britive-app.com "Britive Azure Tenant/Britive Azure Tenant/Directory Reader" -m azlogin -P github-britive)

          # Evaluate the login command directly
          eval "$LOGIN_CMD"

      - name: Confirm Azure Access
        run: |
          az account show
